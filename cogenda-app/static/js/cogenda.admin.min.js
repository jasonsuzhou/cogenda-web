function ready_optimized_page(a){switch(ready_navigation_menu(),ready_common_i18n_info(),a){case"/admin/user-mgmt":ready_user_mgmt();break;case"/admin/resource-mgmt":ready_resource_mgmt()}}function ready_common_i18n_info(){$.ajax({type:"GET",async:!1,dataType:"json",url:"/admin/init-common-language",success:function(a){commonLanguge=$.parseJSON(a)}})}function ready_login_page(){$("#login").on("click",function(a){if(a&&a.preventDefault(),$("#security-login-form").parsley().validate()){var b=$("#username").val().trim(),c=$("#password").val().trim(),d=$("#client").val().trim();credentials={username:b,password:c,client:d};var e=$.ajax({dataType:"json",contentType:"application/json",url:"/security/authenticate",data:JSON.stringify(credentials),type:"POST"});e.done(function(a){var b=JSON.parse(a);return b.auth_success?void(window.location=b.refer):($("#login-msg").text(b.msg),void $("#login-msg-container").show())}),e.fail(function(){})}else console.log("Client side validate error.")})}function ready_navigation_menu(){$("ul.cl-vnavigation li").each(function(a,b){var c=($(b).find("ul"),b.children[0]);c.href==String(window.location)&&$(this).addClass("active")})}function ready_user_mgmt(){ready_common_select2(),render_role_select("1"),ready_common_searchable_multi_select(),ready_common_switch(),$("#role").change(function(){render_resource_select($(this).children("option:selected").val())}),render_user_datatable()}function render_user_datatable(){ready_common_datatable("/admin/users",function(a){off_user_click_event(),$("#add").on("click",function(){reset_user_create_modal(),$("#user-new-modal").modal("show"),$("#user-msg-container").hide(),$("#user-modal-msg-container").hide()}),$("#edit").on("click",function(a){a&&a.preventDefault(),edit_user()}),a.on("dblclick","tr",function(a){a&&a.preventDefault(),edit_user(this)}),$("#delete").on("click",function(a){a&&a.preventDefault(),delete_user()}),$("#save").on("click",function(a){a&&a.preventDefault(),$("#new-modal").parsley().validate()&&save_user()}),$("#reset-password").on("click",function(a){a&&a.preventDefault(),reset_password()}),$("#save-as").on("click",function(a){a&&a.preventDefault(),save_as_user()})})}function off_user_click_event(){$("#add").off("click"),$("#edit").off("click"),$("#delete").off("click"),$("#save").off("click"),$("#reset-password").off("click"),$("#save-as").off("click")}function delete_user(){$("#user-msg-container").hide();var a=$("#username").text().trim(),b=$("#mgmt-datatable").dataTable(),c=b.$("tr.row_selected"),d=c.length,e="";if(d>0){for(i=0;d>i;i++){var f=b.fnGetPosition(c[i]),g=b.fnGetData(f).id;if(a===b.fnGetData(f).username)return void pop_msg("user-msg",commonLanguge["You cannot delete yourself"],1);e=e+g+","}console.log(e.substring(0,e.length-1)),$.ajax({dataType:"json",type:"DELETE",url:"/admin/delete-user/"+e.substring(0,e.length-1),success:function(){pop_msg("user-msg",commonLanguge["Remove user successful"],2)}}),remove_selected_rows(b)}}function save_as_user(a){var b=$("#mgmt-datatable").dataTable(),c=b.$("tr.row_selected").length,d=b.$("tr.row_selected")[0];if("undefined"!=typeof a&&(d=a,c=1),0===c)pop_msg("user-msg",commonLanguge["Select one user"],1);else if(1===c){var e=b.fnGetPosition(d),f=b.fnGetData(e).id,g=$.ajax({dataType:"json",type:"GET",url:"/admin/fetch-user/"+f});g.done(function(a){reset_user_create_modal(),render_role_select(a.role),render_resource_select(a.role,convert_resource(a.resource))}),$("#user-new-modal").modal("show"),$("#user-msg-container").hide(),$("#user-modal-msg-container").hide()}else pop_msg("user-msg",commonLanguge["Selected more than one user"],1)}function edit_user(a){var b=$("#mgmt-datatable").dataTable(),c=b.$("tr.row_selected").length,d=b.$("tr.row_selected")[0];if("undefined"!=typeof a&&(d=a,c=1),0===c)pop_msg("user-msg",commonLanguge["Select one user"],1);else if(1===c){var e=b.fnGetPosition(d),f=b.fnGetData(e).id,g=$.ajax({dataType:"json",type:"GET",url:"/admin/fetch-user/"+f});g.done(function(a){$("#uid").val(a.id),$("#uname").val(a.username),$("#name").val(a.username),$("#password").val("admin"),$("#company").val(a.company),$("#email").val(a.email),$("#mobile").val(a.mobile),$("#notes").val(a.notes),render_role_select(a.role),render_resource_select(a.role,convert_resource(a.resource)),render_active_switch(a.active)}),prepare_edit_user_modal()}else pop_msg("user-msg",commonLanguge["Selected more than one user"],1)}function prepare_edit_user_modal(){$("#new-modal").parsley().reset(),$("#title").text(commonLanguge["Modify User"]),$("#save").text(commonLanguge.Save),$("#password").hide(),$("#reset-password-container").show(),$("#user-new-modal").modal("show"),$("#user-msg-container").hide(),$("#user-modal-msg-container").hide()}function save_user(){var a=$("#uid").val().trim(),b=$("#name").val().trim(),c=$("#password").val().trim(),d=$("#email").val().trim(),e="",f=$("#role").val().trim();if("2"===f){var g=$("#resource").val();if(g){for(var h=0;h<g.length;h++)e=e+g[h]+",";e=e.substring(0,e.length-1)}else e=""}var i={id:a,username:b,password:c,email:d,company:$("#company").val().trim(),mobile:$("#mobile").val().trim(),active:$(".switch-on")&&$(".switch-on").length>0?1:0,notes:$("#notes").val().trim(),resource:e,role:f};$.ajax($("#uid").val().trim()?{dataType:"json",data:JSON.stringify(i),contentType:"application/json",type:"POST",url:"/admin/update-user",success:function(a){a.id?(render_user_datatable(),$("#user-new-modal").modal("hide")):pop_msg("user-modal-msg",a,0)}}:{dataType:"json",data:JSON.stringify(i),contentType:"application/json",type:"POST",url:"/admin/create-user",success:function(a){a.username?(render_user_datatable(),$("#user-new-modal").modal("hide")):pop_msg("user-modal-msg",a,0)}})}function reset_user_create_modal(){$("#new-modal").parsley().reset(),$("#title").text(commonLanguge["Create User"]),$("#uid").val(""),$("#name").val(""),$("#password").val(""),$("#company").val(""),$("#email").val(""),$("#mobile").val(""),$("#notes").val(""),$("#password").show(),$("#reset-password-container").hide(),render_active_switch(),render_role_select("1"),render_resource_select()}function render_active_switch(a){var b=$(".switch-animate");"undefined"!=typeof a?a?(b.removeClass("switch-off"),b.addClass("switch-on")):(b.removeClass("switch-on"),b.addClass("switch-off")):(b.removeClass("switch-off"),b.addClass("switch-on"))}function render_role_select(a){$("#role").select2("val",a)}function convert_resource(a){return""===a?[]:a.split(",")}function render_resource_select(a,b){if("2"===a||"Resource Owner"===a){var c=$.ajax({dataType:"json",type:"GET",url:"/admin/resources",success:function(a){$("#resource").multiSelect("refresh");for(var c=0,d=0;d<a.length-1;d++)"6"===a[d].type&&$("#resource").multiSelect("addOption",{value:a[d].id,text:a[d].name+"["+a[d].vendor+"]",index:c++});$("#resource").multiSelect("deselect_all"),"undefined"!=typeof b&&$("#resource").multiSelect("select",b),$("#resource-container").show()}});c.done(function(){})}else $("#resource-container").hide()}function ready_resource_mgmt(){ready_common_select2(),ready_common_switch(),render_resource_datatable()}function render_resource_datatable(){ready_common_datatable("/admin/resources",function(a){a.on("dblclick","tr",function(a){a&&a.preventDefault(),edit_resource(this)}),$("#update").off("click"),$("#update").on("click",function(a){a&&a.preventDefault(),update_resource()})})}function update_resource(){var a=$("#rid").val().trim(),b=$("#r_desc").val().trim(),c=$("#r_type").val().trim(),d={id:a,desc:b,type:c,active:$(".switch-on")&&$(".switch-on").length>0?1:0};$.ajax({dataType:"json",data:JSON.stringify(d),contentType:"application/json",type:"POST",url:"/admin/update-resource",success:function(a){a.length>0&&a[0].id?(render_resource_datatable(),$("#resource-status-modal").modal("hide")):pop_msg("resource-msg",a,0)}})}function edit_resource(a){var b=$("#mgmt-datatable").dataTable(),c=b.fnGetPosition(a),d=b.fnGetData(c).id,e=$.ajax({dataType:"json",type:"GET",url:"/admin/fetch-resource/"+d});e.done(function(a){1===a.length?($("#rid").val(a[0].id),$("#r_vendor_2").text(""),$("#r_url_2").hide(),$("#r_url_2").attr("href",""),$("#r_url_2").attr("title","")):2===a.length&&($("#rid").val(a[0].id+":"+a[1].id),$("#r_vendor_2").text(a[1].vendor),$("#r_url_2").show(),$("#r_url_2").attr("href",a[1].url),$("#r_url_2").attr("title",a[1].url)),$("#r_desc").val(a[0].description),$("#r_name").text(a[0].name),$("#r_vendor_1").text(a[0].vendor),$("#r_url_1").attr("href",a[0].url),$("#r_url_1").attr("title",a[0].url),render_resource_type_select(a[0].type),render_active_switch(a[0].active),$("#resource-status-modal").modal("show")})}function render_resource_type_select(a){$("#r_type").select2("val",a)}function reset_password(){$("#processing").show();var a=$("#name").val().trim(),b=$("#email").val().trim(),c={username:a,email:b},d=$.ajax({dataType:"json",contentType:"application/json",url:"/admin/reset-password",data:JSON.stringify(c),type:"POST"});d.done(function(a){var b=JSON.parse(a);b.is_success?pop_msg("user-modal-msg",b.msg,2):pop_msg("user-modal-msg",b.msg,1),$("#processing").hide()})}function ready_common_select2(){$(".select2").select2({width:"100%"})}function ready_common_switch(){$(".switch").bootstrapSwitch()}function ready_common_searchable_multi_select(){$(".searchable").multiSelect({selectableHeader:"<input type='text' class='form-control search-input' autocomplete='off' placeholder='Filter String'>",selectionHeader:"<input type='text' class='form-control search-input' autocomplete='off' placeholder='Filter String'>",afterInit:function(){var a=this,b=a.$selectableUl.prev(),c=a.$selectionUl.prev(),d="#"+a.$container.attr("id")+" .ms-elem-selectable:not(.ms-selected)",e="#"+a.$container.attr("id")+" .ms-elem-selection.ms-selected";a.qs1=b.quicksearch(d).on("keydown",function(b){return 40===b.which?(a.$selectableUl.focus(),!1):void 0}),a.qs2=c.quicksearch(e).on("keydown",function(b){return 40==b.which?(a.$selectionUl.focus(),!1):void 0})},afterSelect:function(){this.qs1.cache(),this.qs2.cache()},afterDeselect:function(){this.qs1.cache(),this.qs2.cache()}})}function ready_common_datatable(a,b){$.ajax({dataType:"json",type:"GET",url:a,success:function(c){f="mgmt-datatable";var d=f+"-container";$("#"+d).html('<table class="table table-bordered" id="'+f+'"></table>');var e,f="#"+f;$.ajax({type:"GET",async:!1,dataType:"json",url:"/admin/init-table-language",success:function(a){e=$.parseJSON(a)}});var g=c[c.length-1],h=get_table_columns(g,a),i=$(f).dataTable({aaData:process_user_result(c),aoColumns:h,oLanguage:{sLengthMenu:" "+e.sShowRows+" ",sZeroRecords:e.sZeroRecords,sInfo:e.sInfo,sInfoEmpty:e.sInfoEmpty,sInfoFiltered:e.sInfoFiltered,oPaginate:{sFirst:e.oPaginate_sFirst,sPrevious:e.oPaginate_sPrevious,sNext:e.oPaginate_sNext,sLast:e.oPaginate_sLast}}});$(f).on("click","tbody tr",function(){$(this).toggleClass("row_selected")}),$(".dataTables_filter input").addClass("form-control").attr("placeholder",e.sSearch),$(".dataTables_length select").addClass("form-control"),b(i)}})}function get_table_columns(a,b){return"/admin/users"==b?get_user_table_columns(a):"/admin/resources"==b?get_resource_table_columns(a):void 0}function get_user_table_columns(a){var b=[{sTitle:"ID",mData:"id",bVisible:!1},{sTitle:a.username,mData:"username"},{sTitle:a.company,mData:"company"},{sTitle:a.email,mData:"email"},{sTitle:a.mobile,mData:"mobile"},{sTitle:a.role,mData:"role"},{sTitle:a.active,mData:"active"}];return b}function get_resource_table_columns(a){var b=[{sTitle:"ID",mData:"id",bVisible:!1},{sTitle:a["Resource Name"],mData:"name"},{sTitle:a.Description,mData:"description"},{sTitle:a.Vendor,mData:"vendor"},{sTitle:a["Uploaded Date"],mData:"uploaded_date"},{sTitle:a.Type,mData:"type"},{sTitle:a.Active,mData:"active"}];return b}function process_user_result(a){a.splice(a.length-1,a.length);for(var b=0;b<a.length;b++)a[b].active=get_user_status(a[b].active),a[b].role&&(a[b].role=get_role_name(a[b].role)),a[b].type&&(a[b].type=get_resource_type(a[b].type));return a}function get_resource_type(a){var b="Private";return"1"==a?b="Public - Publications":"2"==a?b="Public - Documentation":"3"==a?b="Public - Examples":"4"==a?b="AllUser - Software Packages":"5"==a?b="AllUser - Installer":"6"==a&&(b="Private"),b}function get_role_name(a){var b="Resource";return"1"==a?b="Resource":"2"==a?b="Resource Owner":"3"==a&&(b="Administrator"),b}function get_user_status(a){var b="No";return a&&(b="Yes"),b}function remove_selected_rows(a){var b=a.$("tr.row_selected");b.each(function(b,c){a.fnDeleteRow(c)})}function pop_msg(a,b,c){var d="",e="";0==c?(e="alert alert-danger",d="fa fa-times-circle sign"):1===c?(e="alert alert-warning",d="fa fa-warning sign"):2===c&&(e="alert alert-success",d="fa fa-check sign"),$("#"+a+"-container").attr("class",e),$("#"+a+"-container i").attr("class",d),$("#"+a).text(b),$("#"+a+"-container").show()}$(document).ready(function(){locale=$("#locale").val(),locale.indexOf("zh")>=0&&(locale="zh_cn"),locale.indexOf("en")>=0&&(locale="en"),window.ParsleyValidator.setLocale(locale);var a=window.location.pathname;"/admin/login"===a?ready_login_page():($("ul.cl-vnavigation li").each(function(a,b){$(b).click(function(){var a=$(b).find("ul");if(!(a.length>0)){var c=$("#main-content"),d=$('<div id="loading" class="loading"><i class="fa fa-spinner"></i></div>');d.appendTo(c),d.fadeIn(0);var e=b.children[0];self.location.href=e,$("ul.cl-vnavigation li.active").removeClass("active"),$(b).addClass("active")}})}),ready_optimized_page(a))});var commonLanguge;