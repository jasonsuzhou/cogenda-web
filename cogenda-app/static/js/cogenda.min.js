function ready_optimized_page(a){switch(ready_navigation_menu(),a){case"/admin/user-mgmt":ready_user_mgmt();break;case"/admin/resource-mgmt":ready_resource_mgmt()}}function ready_navigation_menu(){$("ul.cl-vnavigation li").each(function(a,b){var c=($(b).find("ul"),b.children[0]);c.href==String(window.location)&&$(this).addClass("active")})}function ready_user_mgmt(){ready_common_select2(),render_role_select("1"),ready_common_searchable_multi_select(),ready_common_switch(),$("#role").change(function(){render_resource_select($(this).children("option:selected").val())}),render_user_datatable()}function render_user_datatable(){var a=[{sTitle:"ID",mData:"id",bVisible:!1},{sTitle:"User Name",mData:"username"},{sTitle:"Company",mData:"company"},{sTitle:"Email",mData:"email"},{sTitle:"Mobile",mData:"mobile"},{sTitle:"Role",mData:"role"},{sTitle:"Active",mData:"active"}];ready_common_datatable("/admin/users",a,function(a){$("#add").click(function(){reset_user_create_modal(),$("#user-new-modal").modal("show")}),$("#edit").click(function(a){a&&a.preventDefault(),edit_user()}),a.on("dblclick","tr",function(a){a&&a.preventDefault(),edit_user(this)}),$("#delete").click(function(a){a&&a.preventDefault(),delete_user()}),$("#save").on("click",function(a){a&&a.preventDefault(),$("#new-modal").parsley().validate()&&(save_user(),$("#user-new-modal").modal("hide"))})})}function delete_user(){var a=$("#mgmt-datatable").dataTable(),b=a.$("tr.row_selected"),c=b.length;if(c>0){for(i=0;c>i;i++){var d=a.fnGetPosition(b[i]),e=a.fnGetData(d).id;$.ajax({dataType:"json",type:"DELETE",url:"/admin/delete-user/"+e,success:function(){console.log(">>>>>>>>>>>>delete"+e+"successfully")}})}remove_selected_rows(a)}}function edit_user(a){$("#new-modal").parsley().reset(),$("#title").text("Modify User"),$("#save").text("Save");var b=$("#mgmt-datatable").dataTable(),c=b.$("tr.row_selected").length,d=b.$("tr.row_selected")[0];if("undefined"!=typeof a&&(d=a,c=1),0===c)alert("Select one object to view!");else if(1===c){var e=b.fnGetPosition(d),f=b.fnGetData(e).id;$.ajax({dataType:"json",type:"GET",url:"/admin/fetch-user/"+f,success:function(a){$("#uid").val(a.id),$("#name").val(a.username),$("#password").val(a.password),$("#company").val(a.company),$("#email").val(a.email),$("#mobile").val(a.mobile),$("#notes").val(a.notes),render_role_select(a.role),render_resource_select(a.role,convert_resource(a.resource)),render_active_switch(a.active)}}),$("#user-new-modal").modal("show")}else alert("Selected more than one object!")}function save_user(){var a=$("#uid").val().trim(),b=$("#name").val().trim(),c=$("#password").val().trim(),d=$("#email").val().trim(),e="",f=$("#role").val().trim();if("2"===f){for(var g=$("#resource").val(),h=0;h<g.length;h++)e=e+g[h]+",";e=e.substring(0,e.length-1)}var i={id:a,username:b,password:c,email:d,company:$("#company").val().trim(),mobile:$("#mobile").val().trim(),active:$(".switch-on")&&$(".switch-on").length>0?1:0,notes:$("#notes").val().trim(),resource:e,role:f};$.ajax($("#uid").val().trim()?{dataType:"json",data:JSON.stringify(i),contentType:"application/json",type:"POST",url:"/admin/update-user",success:function(){render_user_datatable()}}:{dataType:"json",data:JSON.stringify(i),contentType:"application/json",type:"POST",url:"/admin/create-user",success:function(){render_user_datatable()}})}function reset_user_create_modal(){$("#new-modal").parsley().reset(),$("#title").text("Create User"),$("#save").text("Create"),$("#uid").val(""),$("#name").val(""),$("#password").val(""),$("#company").val(""),$("#email").val(""),$("#mobile").val(""),$("#notes").val(""),render_active_switch(),render_role_select("1"),render_resource_select()}function render_active_switch(a){var b=$(".switch-animate");"undefined"!=typeof a?"true"===a?(b.removeClass("switch-off"),b.addClass("switch-on")):(b.removeClass("switch-on"),b.addClass("switch-off")):(b.removeClass("switch-off"),b.addClass("switch-on"))}function render_role_select(a){$("#role").select2("val",a)}function convert_resource(a){return""===a?[]:a.split(",")}function render_resource_select(a,b){"2"===a||"Resource Owner"===a?($.ajax({dataType:"json",type:"GET",url:"/admin/resources",success:function(a){for(var b=0;b<a.length;b++)$("#resource").multiSelect("addOption",{value:a[b].id,text:a[b].name+"["+a[b].vendor+"]",index:b})}}),$("#resource").multiSelect("refresh"),"undefined"!=typeof b&&$("#resource").multiSelect("select",b),$("#resource-container").show()):$("#resource-container").hide()}function ready_resource_mgmt(){var a=[{sTitle:"ID",mData:"id",bVisible:!1},{sTitle:"Resource Name",mData:"name"},{sTitle:"Vendor",mData:"vendor"},{sTitle:"Uploaded Date",mData:"uploaded_date"},{sTitle:"Status",mData:"status"},{sTitle:"Type",mData:"type"},{sTitle:"Active",mData:"active"}];ready_common_datatable("/admin/resources",a,function(){})}function ready_common_select2(){$(".select2").select2({width:"100%"})}function ready_common_switch(){$(".switch").bootstrapSwitch()}function ready_common_multi_select_group(){$(".privilegeMultiSelect").multiSelect({selectableOptgroup:!0})}function ready_common_searchable_multi_select(){$(".searchable").multiSelect({selectableHeader:"<input type='text' class='form-control search-input' autocomplete='off' placeholder='Filter String'>",selectionHeader:"<input type='text' class='form-control search-input' autocomplete='off' placeholder='Filter String'>",afterInit:function(){var a=this,b=a.$selectableUl.prev(),c=a.$selectionUl.prev(),d="#"+a.$container.attr("id")+" .ms-elem-selectable:not(.ms-selected)",e="#"+a.$container.attr("id")+" .ms-elem-selection.ms-selected";a.qs1=b.quicksearch(d).on("keydown",function(b){return 40===b.which?(a.$selectableUl.focus(),!1):void 0}),a.qs2=c.quicksearch(e).on("keydown",function(b){return 40==b.which?(a.$selectionUl.focus(),!1):void 0})},afterSelect:function(){this.qs1.cache(),this.qs2.cache()},afterDeselect:function(){this.qs1.cache(),this.qs2.cache()}})}function ready_common_datatable(a,b,c){$.ajax({dataType:"json",type:"GET",url:a,success:function(a){e="mgmt-datatable";var d=e+"-container";$("#"+d).html('<table class="table table-bordered" id="'+e+'"></table>');var e="#"+e,f=$(e).dataTable({aaData:processUserResult(a),aoColumns:b});$(e).on("click","tbody tr",function(){$(this).toggleClass("row_selected")}),$(".dataTables_filter input").addClass("form-control").attr("placeholder","Search"),$(".dataTables_length select").addClass("form-control"),c(f)}})}function processUserResult(a){for(var b=0;b<a.length;b++)a[b].role&&(a[b].role=get_role_name(a[b].role)),a[b].active&&(a[b].active=get_user_status(a[b].active)),a[b].status&&(a[b].status=get_resource_status(a[b].status)),a[b].type&&(a[b].type=get_resource_type(a[b].type));return a}function get_resource_status(a){var b="Fail";return b="1"===a?"Successful":"Fail"}function get_resource_type(a){var b="Restricted";return b="0"==a?"Public":"Restricted"}function get_role_name(a){var b="Resource";return"1"==a?b="Resource":"2"==a?b="Resource Owner":"3"==a&&(b="Administrator"),b}function get_user_status(a){var b="No";return"true"===a&&(b="Yes"),b}function authenticate(){if($("#security-login-form").parsley().validate()){var a=$("#username").val().trim(),b=$("#password").val().trim();credentials={username:a,password:b};var c=$.ajax({dataType:"json",contentType:"application/json",url:"/admin/authenticate",data:JSON.stringify(credentials),type:"POST"});c.done(function(){self.location.href="/admin/user-mgmt"}),c.fail(function(){callback()})}else console.log("Client side validate error.")}function remove_selected_rows(a){var b=a.$("tr.row_selected");b.each(function(b,c){a.fnDeleteRow(c)})}$(document).ready(function(){$("#login").on("click",function(a){if(a&&a.preventDefault(),$("#security-login-form").parsley().validate()){var b=$("#username").val().trim(),c=$("#password").val().trim();credentials={username:b,password:c};var d=$.ajax({dataType:"json",contentType:"application/json",url:"/admin/authenticate",data:JSON.stringify(credentials),type:"POST"});d.done(function(a){console.log("Auth done!"),console.log(a.auth_token),window.location="/admin/user-mgmt"}),d.fail(function(){})}else console.log("Client side validate error.")})});var editor;$(document).ready(function(){$("ul.cl-vnavigation li").each(function(a,b){$(b).click(function(){var a=$(b).find("ul");if(!(a.length>0)){var c=$("#main-content"),d=$('<div id="loading" class="loading"><i class="fa fa-spinner"></i></div>');d.appendTo(c),d.fadeIn(0);var e=b.children[0];self.location.href=e,$("ul.cl-vnavigation li.active").removeClass("active"),$(b).addClass("active")}})}),ready_optimized_page(window.location.pathname)});